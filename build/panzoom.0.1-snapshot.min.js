/*!
 AngularJS pan/zoom v0.1-snapshot
 (c) 2014 Martin Vindahl Olsen
 License: MIT
 Github: https://github.com/mvindahl/angular-pan-zoom
*/
angular.module("panzoom",["monospaced.mousewheel"]).directive("panzoom",["$document",function(o){return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(e,n){var a=n,i=n.find(".pan-zoom-contents"),t=function(o){return Math.pow(e.config.scalePerZoomLevel,o-e.config.neutralZoomLevel)},m=function(o){return Math.log(o)/Math.log(e.config.scalePerZoomLevel)+e.config.neutralZoomLevel};e.config.zoomLevels=e.config.zoomLevels||5,e.config.neutralZoomLevel=e.config.neutralZoomLevel||2,e.config.friction=e.config.friction||10,e.config.haltSpeed=e.config.haltSpeed||100,e.config.scalePerZoomLevel=e.config.scalePerZoomLevel||2,e.config.zoomStepDuration=e.config.zoomStepDuration||.2,e.config.zoomStepDuration=e.config.zoomStepDuration||.2,e.config.modelChangedCallback=e.config.modelChangedCallback||function(){},e.config.zoomToFitZoomLevelFactor=e.config.zoomToFitZoomLevelFactor||.95,e.config.zoomButtonIncrement=e.config.zoomButtonIncrement||1,e.config.initialZoomLevel=e.config.initialZoomLevel||e.config.neutralZoomLevel,e.config.initialPanX=e.config.initialPanX||0,e.config.initialPanY=e.config.initialPanY||0;var l=function(o){var a=n.width(),i=n.height(),l=o.width,r=o.height,c=Math.min(a/l,i/r),s=m(c),f=s*e.config.zoomToFitZoomLevelFactor,v=t(f);return{zoomLevel:f,pan:{x:-o.x*v+(a-l*v)/2,y:-o.y*v+(i-r*v)/2}}};e.base=e.config.initialZoomToFit?l(e.config.initialZoomToFit):{zoomLevel:e.config.initialZoomLevel,pan:{x:e.config.initialPanX,y:e.config.initialPanY}},e.model.zoomLevel=e.base.zoomLevel,e.model.pan={x:e.base.pan.x,y:e.base.pan.y},e.previousPosition=void 0,e.dragging=!1,e.panVelocity=void 0,e.zoomAnimation=void 0;var r=function(){if(e.zoomAnimation){e.model.zoomLevel=e.base.zoomLevel+e.zoomAnimation.deltaZoomLevel*e.zoomAnimation.progress;var o=e.zoomAnimation.translationFromZoom(e.model.zoomLevel);e.model.pan.x=e.base.pan.x+o.x,e.model.pan.y=e.base.pan.y+o.y}else e.model.zoomLevel=e.base.zoomLevel,e.model.pan.x=e.base.pan.x,e.model.pan.y=e.base.pan.y;var n="scale("+t(e.model.zoomLevel)+")";i.css("transform-origin","0 0"),i.css("ms-transform-origin","0 0"),i.css("webkit-transform-origin","0 0"),i.css("transform",n),i.css("ms-transform",n),i.css("webkit-transform",n),i.css("left",e.model.pan.x),i.css("top",e.model.pan.y)},c=function(){var o={x:a.width()/2,y:a.height()/2};return o},s=function(o,n){e.zoomAnimation&&(e.base.zoomLevel=e.model.zoomLevel,e.base.pan.x=e.model.pan.x,e.base.pan.y=e.model.pan.y,e.zoomAnimation=void 0),o=Math.max(0,o),o=Math.min(e.config.zoomLevels-1,o);var a=o-e.base.zoomLevel;if(a){var i=e.config.zoomStepDuration,m=n||c(),l=t(e.base.zoomLevel),r={x:e.base.pan.x,y:e.base.pan.y},s=function(o){var e=t(o),n={x:m.x-e/l*(m.x-r.x),y:m.y-e/l*(m.y-r.y)};return{x:n.x-r.x,y:n.y-r.y}};e.zoomAnimation={deltaZoomLevel:a,translationFromZoom:s,duration:i,progress:0}}};e.model.changeZoomLevel=s;var f=function(o){s(e.base.zoomLevel+e.config.zoomButtonIncrement,o)};e.model.zoomIn=f;var v=function(o){s(e.base.zoomLevel-e.config.zoomButtonIncrement,o)};e.model.zoomOut=v;var g=function(o){var n=o,a=t(e.base.zoomLevel),i=e.base.pan;return{x:n.x*a+i.x,y:n.y*a+i.y}};e.model.getViewPosition=g;var p=function(o){var n=o,a=t(e.base.zoomLevel),i=e.base.pan;return{x:1/a*(n.x-i.x),y:1/a*(n.y-i.y)}};e.model.getModelPosition=p;var u=function(o){e.base=l(o)};e.model.zoomToFit=u;var d=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},y=function(){var o=jQuery.now();return function(){var n=jQuery.now(),a=(n-o)/1e3;if(o=n,e.dragging)return!0;if(e.zoomAnimation&&(e.zoomAnimation.progress+=a/e.zoomAnimation.duration,e.zoomAnimation.progress>=1&&(e.zoomAnimation.progress=1,r(),e.base.zoomLevel=e.model.zoomLevel,e.base.pan.x=e.model.pan.x,e.base.pan.y=e.model.pan.y,e.zoomAnimation=void 0,e.config.modelChangedCallback(e.model))),e.panVelocity)for(;a>0;){var i=Math.min(.02,a);a-=i,e.base.pan.x+=e.panVelocity.x*i,e.panVelocity.x*=1-e.config.friction*i,e.base.pan.y+=e.panVelocity.y*i,e.panVelocity.y*=1-e.config.friction*i;var t=d(e.panVelocity);if(t<e.config.haltSpeed){e.panVelocity=void 0,e.config.modelChangedCallback(e.model);break}}return r(),!0}};r();var z=new y;jQuery.fx.timer(z),e.onDblClick=function(o){var e={x:o.pageX-a.offset().left,y:o.pageY-a.offset().top};f(e)};var x,b;e.onMousedown=function(n){b={x:n.pageX,y:n.pageY},x=jQuery.now(),e.dragging=!0,o.on("mousemove",e.onMousemove),o.on("mouseup",e.onMouseup)};var L=function(o){o.x=o.x||0,o.y=o.y||0,e.base.pan.x+=o.x,e.base.pan.y+=o.y,r()};e.model.pan=L,e.onMousemove=function(o){!e.dragging;var n=jQuery.now(),a=(n-x)/1e3;x=n;var i={x:o.pageX-b.x,y:o.pageY-b.y};L(i),e.panVelocity={x:i.x/a,y:i.y/a},b={x:o.pageX,y:o.pageY},o.preventDefault()},e.onMouseup=function(){var n=jQuery.now(),a=(n-x)/1e3;if(e.panVelocity){var i=Math.max(0,Math.pow(a+1,-4)-.2);e.panVelocity.x*=i,e.panVelocity.y*=i}e.dragging=!1,o.off("mousemove",e.onMousemove),o.off("mouseup",e.onMouseup)},e.onMouseleave=function(){e.onMouseup()},e.onMouseWheel=function(o,n,i,t){if(o.preventDefault(),!e.zoomAnimation){var m=t/Math.abs(t),l={x:o.pageX-a.offset().left,y:o.pageY-a.offset().top};0>m?f(l):v(l)}}}],template:'<div class="pan-zoom-frame" ng-dblclick="onDblClick($event)" ng-mousedown="onMousedown($event)" msd-wheel="onMouseWheel($event, $delta, $deltaX, $deltaY)" style="position:relative;overflow:hidden;cursor:move"><div class="pan-zoom-contents" style="position:absolute;left:0px;top:0px" ng-transclude></div></div>',replace:!0}}]);
angular.module("panzoomwidget",[]).directive("panzoomwidget",["$document",function(o){return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(e,n){var i=n.find(".zoom-slider-widget"),t=!1,m=function(o){return(e.config.zoomLevels-o-1)*e.widgetConfig.zoomLevelHeight},l=function(o){return e.config.zoomLevels-1-o/e.widgetConfig.zoomLevelHeight},u=function(o){var i=o.pageY-n.find(".zoom-slider").offset().top-e.widgetConfig.zoomLevelHeight/2;return l(i)};e.getZoomLevels=function(){for(var o=[],n=e.config.zoomLevels-1;n>=0;n--)o.push(n);return o},e.widgetConfig={zoomLevelHeight:10},e.zoomIn=function(){e.model.zoomIn()},e.zoomOut=function(){e.model.zoomOut()},e.onClick=function(o){var n=u(o);e.model.changeZoomLevel(n)},e.onMousedown=function(){t=!0,o.on("mousemove",e.onMousemove),o.on("mouseup",e.onMouseup)},e.onMousemove=function(o){o.preventDefault();var n=u(o);e.model.changeZoomLevel(n)},e.onMouseup=function(){t=!1,o.off("mousemove",e.onMousemove),o.off("mouseup",e.onMouseup)},e.onMouseleave=function(){t=!1},setInterval(function(){i.css("top",m(e.model.zoomLevel)+"px")},25)}],template:'<div class="panzoomwidget"><div ng-click="zoomIn()" ng-mouseenter="zoomToLevelIfDragging(config.zoomLevels - 1)" class="zoom-button zoom-button-in">+</div><div class="zoom-slider" ng-mousedown="onMousedown()" ng-click="onClick($event)"><div class="zoom-slider-widget" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div><div ng-repeat="zoomLevel in getZoomLevels()" " class="zoom-level zoom-level-{{zoomLevel}}" style="height:{{widgetConfig.zoomLevelHeight}}px"></div></div><div ng-click="zoomOut()" ng-mouseenter="zoomToLevelIfDragging(0)" class="zoom-button zoom-button-out">-</div><div ng-transclude></div></div>',replace:!0}}]);
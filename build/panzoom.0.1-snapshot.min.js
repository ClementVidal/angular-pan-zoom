/*!
 AngularJS pan/zoom v0.1-snapshot
 (c) 2014 Martin Vindahl Olsen
 License: MIT
 Github: https://github.com/mvindahl/angular-pan-zoom
*/
angular.module("panzoom",["monospaced.mousewheel"]).directive("panzoom",function(){return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(o,e){o.config.zoomLevels=o.config.zoomLevels||5,o.config.neutralZoomLevel=o.config.neutralZoomLevel||2,o.config.initialZoomLevel=o.config.initialZoomLevel||o.config.neutralZoomLevel,o.config.initialPanX=o.config.initialPanX||0,o.config.initialPanY=o.config.initialPanY||0,o.config.friction=o.config.friction||10,o.config.haltSpeed=o.config.haltSpeed||100,o.config.scalePerZoomLevel=o.config.scalePerZoomLevel||2,o.config.zoomStepDuration=o.config.zoomStepDuration||.2,o.config.zoomStepDuration=o.config.zoomStepDuration||.2,o.config.modelChangedCallback=o.config.modelChangedCallback||function(){},o.base={zoomLevel:o.config.initialZoomLevel,pan:{x:o.config.initialPanX,y:o.config.initialPanY}},o.model.zoomLevel=o.base.zoomLevel,o.model.pan={x:o.base.pan.x,y:o.base.pan.y},o.previousPosition=void 0,o.dragging=!1,o.panVelocity=void 0,o.zoomAnimation=void 0;var n=function(e){return Math.pow(o.config.scalePerZoomLevel,e-o.config.neutralZoomLevel)},a=e,i=e.find(".pan-zoom-contents"),t=function(){if(o.zoomAnimation){o.model.zoomLevel=o.base.zoomLevel+o.zoomAnimation.deltaZoomLevel*o.zoomAnimation.progress;var e=o.zoomAnimation.translationFromZoom(o.model.zoomLevel);o.model.pan.x=o.base.pan.x+e.x,o.model.pan.y=o.base.pan.y+e.y}else o.model.zoomLevel=o.base.zoomLevel,o.model.pan.x=o.base.pan.x,o.model.pan.y=o.base.pan.y;var a="scale("+n(o.model.zoomLevel)+")";i.css("transform-origin","0 0"),i.css("ms-transform-origin","0 0"),i.css("webkit-transform-origin","0 0"),i.css("transform",a),i.css("ms-transform",a),i.css("webkit-transform",a),i.css("left",o.model.pan.x),i.css("top",o.model.pan.y)},l=function(){var o={x:a.width()/2,y:a.height()/2};return o},m=function(e,a){if(!o.zoomAnimation){e=Math.max(0,e),e=Math.min(o.config.zoomLevels-1,e);var i=e-o.base.zoomLevel;if(i){var t=o.config.zoomStepDuration,m=a||l(),r=n(o.base.zoomLevel),s={x:o.base.pan.x,y:o.base.pan.y},c=function(o){var e=n(o),a={x:m.x-e/r*(m.x-s.x),y:m.y-e/r*(m.y-s.y)};return{x:a.x-s.x,y:a.y-s.y}};o.zoomAnimation={deltaZoomLevel:i,translationFromZoom:c,duration:t,progress:0}}}};o.model.changeZoomLevel=m;var r=function(e){m(Math.floor(o.base.zoomLevel+1),e)};o.model.zoomIn=r;var s=function(e){m(Math.ceil(o.base.zoomLevel-1),e)};o.model.zoomOut=s;var c=function(e){var a=e,i=n(o.base.zoomLevel),t=o.base.pan;return{x:a.x*i+t.x,y:a.y*i+t.y}};o.model.getViewPosition=c;var f=function(e){var a=e,i=n(o.base.zoomLevel),t=o.base.pan;return{x:1/i*(a.x-t.x),y:1/i*(a.y-t.y)}};o.model.getModelPosition=f;var v=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},p=function(){var e=jQuery.now();return function(){var n=jQuery.now(),a=(n-e)/1e3;if(e=n,o.dragging)return!0;if(o.zoomAnimation&&(o.zoomAnimation.progress+=a/o.zoomAnimation.duration,o.zoomAnimation.progress>=1&&(o.zoomAnimation.progress=1,t(),o.base.zoomLevel=o.model.zoomLevel,o.base.pan.x=o.model.pan.x,o.base.pan.y=o.model.pan.y,o.zoomAnimation=void 0,o.config.modelChangedCallback(o.model))),o.panVelocity){o.base.pan.x+=o.panVelocity.x*a,o.panVelocity.x*=1-o.config.friction*a,o.base.pan.y+=o.panVelocity.y*a,o.panVelocity.y*=1-o.config.friction*a;var i=v(o.panVelocity);i<o.config.haltSpeed&&(o.panVelocity=void 0),o.config.modelChangedCallback(o.model)}return t(),!0}};t();var g=new p;jQuery.fx.timer(g),o.onDblClick=function(o){var e={x:o.clientX-a.offset().left,y:o.clientY-a.offset().top};r(e)};var u,d;o.onMousedown=function(e){d={x:e.pageX,y:e.pageY},u=jQuery.now(),o.dragging=!0},o.onMousemove=function(e){if(o.dragging){var n=jQuery.now(),a=(n-u)/1e3;u=n;var i={x:e.pageX-d.x,y:e.pageY-d.y};o.base.pan.x+=i.x,o.base.pan.y+=i.y,t(),o.panVelocity={x:i.x/a,y:i.y/a},d={x:e.pageX,y:e.pageY},e.preventDefault()}},o.onMouseup=function(){var e=jQuery.now(),n=(e-u)/1e3;if(o.panVelocity){var a=Math.max(0,Math.pow(n+1,-4)-.2);o.panVelocity.x*=a,o.panVelocity.y*=a}o.dragging=!1},o.onMouseleave=function(){o.onMouseup()},o.onMouseWheel=function(e,n,i,t){if(e.preventDefault(),!o.zoomAnimation){var l=t/Math.abs(t),m={x:e.clientX-a.offset().left,y:e.clientY-a.offset().top};0>l?r(m):s(m)}}}],template:'<div class="pan-zoom-frame" ng-dblclick="onDblClick($event)" ng-mousedown="onMousedown($event)" ng-mousemove="onMousemove($event)" ng-mouseup="onMouseup($event)" ng-mouseleave="onMouseleave($event)" msd-wheel="onMouseWheel($event, $delta, $deltaX, $deltaY)" style="position:relative;overflow:hidden"><div class="pan-zoom-contents" style="position:absolute;left:0px;top:0px" ng-transclude></div></div>',replace:!0}});
angular.module("panzoomwidget",[]).directive("panzoomwidget",function(){return{restrict:"E",transclude:!1,scope:{config:"=",model:"="},controller:["$scope","$element",function(o,e){var i=e.find(".zoom-slider-widget");o.getZoomLevels=function(){for(var e=[],i=0;i<o.config.zoomLevels;i++)e.push(i);return e},o.widgetConfig={zoomLevelHeight:10},o.zoomIn=function(){o.model.zoomIn()},o.zoomOut=function(){o.model.zoomOut()},setInterval(function(){i.css("top",(o.config.zoomLevels-o.model.zoomLevel-1)*o.widgetConfig.zoomLevelHeight+"px")},25)}],template:'<div class="panzoomwidget"><div ng-click="zoomIn()" class="zoom-button zoom-button-in">+</div><div class="zoom-slider"><div class="zoom-slider-widget" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div><div ng-repeat="zoomLevel in getZoomLevels()" class="zoom-level zoom-level-{{zoomLevel}}" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div></div><div ng-click="zoomOut()" class="zoom-button zoom-button-out">-</div></div>',replace:!0}});
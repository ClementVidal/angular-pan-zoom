/*!
 AngularJS pan/zoom v0.1-snapshot
 (c) 2014 Martin Vindahl Olsen
 License: MIT
 Github: https://github.com/mvindahl/angular-pan-zoom
*/
angular.module("panzoom",["monospaced.mousewheel"]).directive("panzoom",function(){return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(o,e){var n=e,a=e.find(".pan-zoom-contents"),i=function(e){return Math.pow(o.config.scalePerZoomLevel,e-o.config.neutralZoomLevel)},t=function(e){return Math.log(e)/Math.log(o.config.scalePerZoomLevel)+o.config.neutralZoomLevel};o.config.zoomLevels=o.config.zoomLevels||5,o.config.neutralZoomLevel=o.config.neutralZoomLevel||2,o.config.friction=o.config.friction||10,o.config.haltSpeed=o.config.haltSpeed||100,o.config.scalePerZoomLevel=o.config.scalePerZoomLevel||2,o.config.zoomStepDuration=o.config.zoomStepDuration||.2,o.config.zoomStepDuration=o.config.zoomStepDuration||.2,o.config.modelChangedCallback=o.config.modelChangedCallback||function(){},o.config.zoomToFitZoomLevelFactor=o.config.zoomToFitZoomLevelFactor||.95,o.config.initialZoomLevel=o.config.initialZoomLevel||o.config.neutralZoomLevel,o.config.initialPanX=o.config.initialPanX||0,o.config.initialPanY=o.config.initialPanY||0;var l=function(n){var a=e.width(),l=e.height(),m=n.width,r=n.height,c=Math.min(a/m,l/r),s=t(c),f=s*o.config.zoomToFitZoomLevelFactor,v=i(f);return{zoomLevel:f,pan:{x:-n.x*v+(a-m*v)/2,y:-n.y*v+(l-r*v)/2}}};o.base=o.config.initialZoomToFit?l(o.config.initialZoomToFit):{zoomLevel:o.config.initialZoomLevel,pan:{x:o.config.initialPanX,y:o.config.initialPanY}},o.model.zoomLevel=o.base.zoomLevel,o.model.pan={x:o.base.pan.x,y:o.base.pan.y},o.previousPosition=void 0,o.dragging=!1,o.panVelocity=void 0,o.zoomAnimation=void 0;var m=function(){if(o.zoomAnimation){o.model.zoomLevel=o.base.zoomLevel+o.zoomAnimation.deltaZoomLevel*o.zoomAnimation.progress;var e=o.zoomAnimation.translationFromZoom(o.model.zoomLevel);o.model.pan.x=o.base.pan.x+e.x,o.model.pan.y=o.base.pan.y+e.y}else o.model.zoomLevel=o.base.zoomLevel,o.model.pan.x=o.base.pan.x,o.model.pan.y=o.base.pan.y;var n="scale("+i(o.model.zoomLevel)+")";a.css("transform-origin","0 0"),a.css("ms-transform-origin","0 0"),a.css("webkit-transform-origin","0 0"),a.css("transform",n),a.css("ms-transform",n),a.css("webkit-transform",n),a.css("left",o.model.pan.x),a.css("top",o.model.pan.y)},r=function(){var o={x:n.width()/2,y:n.height()/2};return o},c=function(e,n){o.zoomAnimation&&(o.base.zoomLevel=o.model.zoomLevel,o.base.pan.x=o.model.pan.x,o.base.pan.y=o.model.pan.y,o.zoomAnimation=void 0),e=Math.max(0,e),e=Math.min(o.config.zoomLevels-1,e);var a=e-o.base.zoomLevel;if(a){var t=o.config.zoomStepDuration,l=n||r(),m=i(o.base.zoomLevel),c={x:o.base.pan.x,y:o.base.pan.y},s=function(o){var e=i(o),n={x:l.x-e/m*(l.x-c.x),y:l.y-e/m*(l.y-c.y)};return{x:n.x-c.x,y:n.y-c.y}};o.zoomAnimation={deltaZoomLevel:a,translationFromZoom:s,duration:t,progress:0}}};o.model.changeZoomLevel=c;var s=function(e){c(Math.floor(o.base.zoomLevel+1),e)};o.model.zoomIn=s;var f=function(e){c(Math.ceil(o.base.zoomLevel-1),e)};o.model.zoomOut=f;var v=function(e){var n=e,a=i(o.base.zoomLevel),t=o.base.pan;return{x:n.x*a+t.x,y:n.y*a+t.y}};o.model.getViewPosition=v;var g=function(e){var n=e,a=i(o.base.zoomLevel),t=o.base.pan;return{x:1/a*(n.x-t.x),y:1/a*(n.y-t.y)}};o.model.getModelPosition=g;var p=function(e){o.base=l(e)};o.model.zoomToFit=p;var u=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},d=function(){var e=jQuery.now();return function(){var n=jQuery.now(),a=(n-e)/1e3;if(e=n,o.dragging)return!0;if(o.zoomAnimation&&(o.zoomAnimation.progress+=a/o.zoomAnimation.duration,o.zoomAnimation.progress>=1&&(o.zoomAnimation.progress=1,m(),o.base.zoomLevel=o.model.zoomLevel,o.base.pan.x=o.model.pan.x,o.base.pan.y=o.model.pan.y,o.zoomAnimation=void 0,o.config.modelChangedCallback(o.model))),o.panVelocity){o.base.pan.x+=o.panVelocity.x*a,o.panVelocity.x*=1-o.config.friction*a,o.base.pan.y+=o.panVelocity.y*a,o.panVelocity.y*=1-o.config.friction*a;var i=u(o.panVelocity);i<o.config.haltSpeed&&(o.panVelocity=void 0,o.config.modelChangedCallback(o.model))}return m(),!0}};m();var y=new d;jQuery.fx.timer(y),o.onDblClick=function(o){var e={x:o.clientX-n.offset().left,y:o.clientY-n.offset().top};s(e)};var z,x;o.onMousedown=function(e){x={x:e.pageX,y:e.pageY},z=jQuery.now(),o.dragging=!0},o.onMousemove=function(e){if(o.dragging){var n=jQuery.now(),a=(n-z)/1e3;z=n;var i={x:e.pageX-x.x,y:e.pageY-x.y};o.base.pan.x+=i.x,o.base.pan.y+=i.y,m(),o.panVelocity={x:i.x/a,y:i.y/a},x={x:e.pageX,y:e.pageY},e.preventDefault()}},o.onMouseup=function(){var e=jQuery.now(),n=(e-z)/1e3;if(o.panVelocity){var a=Math.max(0,Math.pow(n+1,-4)-.2);o.panVelocity.x*=a,o.panVelocity.y*=a}o.dragging=!1},o.onMouseleave=function(){o.onMouseup()},o.onMouseWheel=function(e,a,i,t){if(e.preventDefault(),!o.zoomAnimation){var l=t/Math.abs(t),m={x:e.clientX-n.offset().left,y:e.clientY-n.offset().top};0>l?s(m):f(m)}}}],template:'<div class="pan-zoom-frame" ng-dblclick="onDblClick($event)" ng-mousedown="onMousedown($event)" ng-mousemove="onMousemove($event)" ng-mouseup="onMouseup($event)" ng-mouseleave="onMouseleave($event)" msd-wheel="onMouseWheel($event, $delta, $deltaX, $deltaY)" style="position:relative;overflow:hidden"><div class="pan-zoom-contents" style="position:absolute;left:0px;top:0px" ng-transclude></div></div>',replace:!0}});
angular.module("panzoomwidget",[]).directive("panzoomwidget",function(){return{restrict:"E",transclude:!1,scope:{config:"=",model:"="},controller:["$scope","$element",function(o,e){var n=e.find(".zoom-slider-widget"),i=!1;o.getZoomLevels=function(){for(var e=[],n=o.config.zoomLevels-1;n>=0;n--)e.push(n);return e},o.widgetConfig={zoomLevelHeight:10},o.zoomIn=function(){o.model.zoomIn()},o.zoomOut=function(){o.model.zoomOut()},o.zoomToLevel=function(e){o.model.changeZoomLevel(e)},o.onMousedown=function(){i=!0},o.zoomToLevelIfDragging=function(e){i&&o.model.changeZoomLevel(e)},o.onMouseup=function(){i=!1},o.onMouseleave=function(){i=!1},setInterval(function(){n.css("top",(o.config.zoomLevels-o.model.zoomLevel-1)*o.widgetConfig.zoomLevelHeight+"px")},25)}],template:'<div class="panzoomwidget" ng-mouseleave="onMouseleave()"><div ng-click="zoomIn()" ng-mouseenter="zoomToLevelIfDragging(config.zoomLevels - 1)" class="zoom-button zoom-button-in">+</div><div class="zoom-slider" ng-mousedown="onMousedown()" ng-mouseup="onMouseup()"><div class="zoom-slider-widget" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div><div ng-repeat="zoomLevel in getZoomLevels()" ng-mouseenter="zoomToLevelIfDragging(zoomLevel)" ng-click="zoomToLevel(zoomLevel)" class="zoom-level zoom-level-{{zoomLevel}}" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div></div><div ng-click="zoomOut()" ng-mouseenter="zoomToLevelIfDragging(0)" class="zoom-button zoom-button-out">-</div></div>',replace:!0}});
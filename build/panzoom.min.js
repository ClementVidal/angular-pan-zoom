angular.module("panzoom",["monospaced.mousewheel"]).directive("panzoom",function(){return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:function(o,e){o.config.zoomLevels=o.config.zoomLevels||5,o.config.neutralZoomLevel=o.config.neutralZoomLevel||2,o.config.initialZoomLevel=o.config.initialZoomLevel||o.config.neutralZoomLevel,o.config.initialPanX=o.config.initialPanX||0,o.config.initialPanY=o.config.initialPanY||0,o.config.friction=o.config.friction||10,o.config.haltSpeed=o.config.haltSpeed||100,o.config.scalePerZoomLevel=o.config.scalePerZoomLevel||2,o.config.zoomStepDuration=o.config.zoomStepDuration||.2,o.base={zoomLevel:o.config.initialZoomLevel,pan:{x:o.config.initialPanX,y:o.config.initialPanY}},o.model.zoomLevel=o.base.zoomLevel,o.model.pan={x:o.base.pan.x,y:o.base.pan.y},o.previousPosition=void 0,o.dragging=!1,o.panVelocity=void 0,o.zoomAnimation=void 0;var n=function(e){return Math.pow(o.config.scalePerZoomLevel,e-o.config.neutralZoomLevel)},i=e,a=e.find(".pan-zoom-contents"),t=function(){if(o.zoomAnimation){o.model.zoomLevel=o.base.zoomLevel+o.zoomAnimation.deltaZoomLevel*o.zoomAnimation.progress;var e=o.zoomAnimation.translationFromZoom(o.model.zoomLevel);o.model.pan.x=o.base.pan.x+e.x,o.model.pan.y=o.base.pan.y+e.y}else o.model.zoomLevel=o.base.zoomLevel,o.model.pan.x=o.base.pan.x,o.model.pan.y=o.base.pan.y;var i="scale("+n(o.model.zoomLevel)+")";a.css("transform-origin","0 0"),a.css("ms-transform-origin","0 0"),a.css("webkit-transform-origin","0 0"),a.css("transform",i),a.css("ms-transform",i),a.css("webkit-transform",i),a.css("left",o.model.pan.x),a.css("top",o.model.pan.y)},l=function(){var o={x:i.width()/2,y:i.height()/2};return o},m=function(e,i){if(!o.zoomAnimation){e=Math.max(0,e),e=Math.min(o.config.zoomLevels-1,e);var a=e-o.base.zoomLevel;if(a){var t=o.config.zoomStepDuration,m=i||l(),r=n(o.base.zoomLevel),s={x:o.base.pan.x,y:o.base.pan.y},c=function(o){var e=n(o),i={x:m.x-e/r*(m.x-s.x),y:m.y-e/r*(m.y-s.y)};return{x:i.x-s.x,y:i.y-s.y}};o.zoomAnimation={deltaZoomLevel:a,translationFromZoom:c,duration:t,progress:0}}}};o.model.changeZoomLevel=m;var r=function(e){m(Math.floor(o.base.zoomLevel+1),e)};o.model.zoomIn=r;var s=function(e){m(Math.ceil(o.base.zoomLevel-1),e)};o.model.zoomOut=s;var c=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},f=function(){var e=jQuery.now();return function(){var n=jQuery.now(),i=(n-e)/1e3;if(e=n,o.dragging)return!0;if(o.zoomAnimation&&(o.zoomAnimation.progress+=i/o.zoomAnimation.duration,o.zoomAnimation.progress>=1&&(o.zoomAnimation.progress=1,t(),o.base.zoomLevel=o.model.zoomLevel,o.base.pan.x=o.model.pan.x,o.base.pan.y=o.model.pan.y,o.zoomAnimation=void 0)),o.panVelocity){o.base.pan.x+=o.panVelocity.x*i,o.panVelocity.x*=1-o.config.friction*i,o.base.pan.y+=o.panVelocity.y*i,o.panVelocity.y*=1-o.config.friction*i;var a=c(o.panVelocity);a<o.config.haltSpeed&&(o.panVelocity=void 0)}return t(),!0}};t();var p=new f;jQuery.fx.timer(p),o.onDblClick=function(o){var e={x:o.clientX-i.offset().left,y:o.clientY-i.offset().top};r(e)};var v,g;o.onMousedown=function(e){g={x:e.pageX,y:e.pageY},v=jQuery.now(),o.dragging=!0},o.onMousemove=function(e){if(o.dragging){var n=jQuery.now(),i=(n-v)/1e3;v=n;var a={x:e.pageX-g.x,y:e.pageY-g.y};o.base.pan.x+=a.x,o.base.pan.y+=a.y,t(),o.panVelocity={x:a.x/i,y:a.y/i},g={x:e.pageX,y:e.pageY},e.preventDefault()}},o.onMouseup=function(){var e=jQuery.now(),n=(e-v)/1e3;if(o.panVelocity){var i=Math.max(0,Math.pow(n+1,-4)-.2);o.panVelocity.x*=i,o.panVelocity.y*=i}o.dragging=!1},o.onMouseWheel=function(e,n,a,t){if(e.preventDefault(),!o.zoomAnimation){var l=t/Math.abs(t),m={x:e.clientX-i.offset().left,y:e.clientY-i.offset().top};0>l?r(m):s(m)}}},template:'<div class="pan-zoom-frame" ng-dblclick="onDblClick($event)" ng-mousedown="onMousedown($event)" ng-mousemove="onMousemove($event)" ng-mouseup="onMouseup($event)" msd-wheel="onMouseWheel($event, $delta, $deltaX, $deltaY)" style="position:relative;overflow: hidden"><div class="pan-zoom-contents" style="position:absolute;left:0px;top:0px" ng-transclude></div></div>',replace:!0}});
angular.module("panzoomwidget",[]).directive("panzoomwidget",function(){return{restrict:"E",transclude:!1,scope:{config:"=",model:"="},controller:function(o,e){var i=e.find(".zoom-slider-widget");o.getZoomLevels=function(){for(var e=[],i=0;i<o.config.zoomLevels;i++)e.push(i);return e},o.widgetConfig={zoomLevelHeight:10},o.zoomIn=function(){o.model.zoomIn()},o.zoomOut=function(){o.model.zoomOut()},setInterval(function(){i.css("top",(o.config.zoomLevels-o.model.zoomLevel-1)*o.widgetConfig.zoomLevelHeight+"px")},25)},template:'<div class="panzoomwidget"><div ng-click="zoomIn()" class="zoom-button zoom-button-in">+</div><div class="zoom-slider"><div class="zoom-slider-widget" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div><div ng-repeat="zoomLevel in getZoomLevels()" class="zoom-level zoom-level-{{zoomLevel}}" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div></div><div ng-click="zoomOut()" class="zoom-button zoom-button-out">-</div></div>',replace:!0}});
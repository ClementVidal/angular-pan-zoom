/*!
 AngularJS pan/zoom v1.0.0-snapshot
 (c) 2014 Martin Vindahl Olsen
 License: MIT
 Github: https://github.com/mvindahl/angular-pan-zoom
*/
angular.module("panzoom",["monospaced.mousewheel"]).directive("panzoom",["$document","PanZoomService",function(o,e){var n={};return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(e,i){var a=i,t=i.find(".pan-zoom-contents"),l=function(o){return Math.pow(e.config.scalePerZoomLevel,o-e.config.neutralZoomLevel)},m=function(o){return Math.log(o)/Math.log(e.config.scalePerZoomLevel)+e.config.neutralZoomLevel};e.config.zoomLevels=e.config.zoomLevels||5,e.config.neutralZoomLevel=e.config.neutralZoomLevel||2,e.config.friction=e.config.friction||10,e.config.haltSpeed=e.config.haltSpeed||100,e.config.scalePerZoomLevel=e.config.scalePerZoomLevel||2,e.config.zoomStepDuration=e.config.zoomStepDuration||.2,e.config.zoomStepDuration=e.config.zoomStepDuration||.2,e.config.modelChangedCallback=e.config.modelChangedCallback||function(){},e.config.zoomToFitZoomLevelFactor=e.config.zoomToFitZoomLevelFactor||.95,e.config.zoomButtonIncrement=e.config.zoomButtonIncrement||1,e.config.initialZoomLevel=e.config.initialZoomLevel||e.config.neutralZoomLevel,e.config.initialPanX=e.config.initialPanX||0,e.config.initialPanY=e.config.initialPanY||0,e.config.zoomOnDoubleClick=void 0!==e.config.zoomOnDoubleClick?e.config.zoomOnDoubleClick:!0,e.config.zoomOnMouseWheel=void 0!==e.config.zoomOnMouseWheel?e.config.zoomOnMouseWheel:!0,e.config.panOnClickDrag=void 0!==e.config.panOnClickDrag?e.config.panOnClickDrag:!0;var c=function(o){var n=i.width(),a=i.height(),t=o.width,c=o.height,r=Math.min(n/t,a/c),f=m(r),s=f*e.config.zoomToFitZoomLevelFactor,g=l(s);return{zoomLevel:s,pan:{x:-o.x*g+(n-t*g)/2,y:-o.y*g+(a-c*g)/2}}};e.base=e.config.initialZoomToFit?c(e.config.initialZoomToFit):{zoomLevel:e.config.initialZoomLevel,pan:{x:e.config.initialPanX,y:e.config.initialPanY}},e.model.zoomLevel=e.base.zoomLevel,e.model.pan={x:e.base.pan.x,y:e.base.pan.y},e.previousPosition=void 0,e.dragging=!1,e.panVelocity=void 0,e.zoomAnimation=void 0;var r=function(){if(e.zoomAnimation){e.model.zoomLevel=e.base.zoomLevel+e.zoomAnimation.deltaZoomLevel*e.zoomAnimation.progress;var o=e.zoomAnimation.translationFromZoom(e.model.zoomLevel);e.model.pan.x=e.base.pan.x+o.x,e.model.pan.y=e.base.pan.y+o.y}else e.model.zoomLevel=e.base.zoomLevel,e.model.pan.x=e.base.pan.x,e.model.pan.y=e.base.pan.y;var n="scale("+l(e.model.zoomLevel)+")";t.css("transform-origin","0 0"),t.css("ms-transform-origin","0 0"),t.css("webkit-transform-origin","0 0"),t.css("transform",n),t.css("ms-transform",n),t.css("webkit-transform",n),t.css("left",e.model.pan.x),t.css("top",e.model.pan.y)},f=function(){var o={x:a.width()/2,y:a.height()/2};return o},s=function(o,n){e.zoomAnimation&&(e.base.zoomLevel=e.model.zoomLevel,e.base.pan.x=e.model.pan.x,e.base.pan.y=e.model.pan.y,e.zoomAnimation=void 0),o=Math.max(0,o),o=Math.min(e.config.zoomLevels-1,o);var i=o-e.base.zoomLevel;if(i){var a=e.config.zoomStepDuration,t=n||f(),m=l(e.base.zoomLevel),c={x:e.base.pan.x,y:e.base.pan.y},r=function(o){var e=l(o),n={x:t.x-e/m*(t.x-c.x),y:t.y-e/m*(t.y-c.y)};return{x:n.x-c.x,y:n.y-c.y}};e.zoomAnimation={deltaZoomLevel:i,translationFromZoom:r,duration:a,progress:0}}};e.model.changeZoomLevel=s;var g=function(o){s(e.base.zoomLevel+e.config.zoomButtonIncrement,o)},u=function(o){s(e.base.zoomLevel-e.config.zoomButtonIncrement,o)},p=function(o){var n=o,i=l(e.base.zoomLevel),a=e.base.pan;return{x:n.x*i+a.x,y:n.y*i+a.y}},v=function(o){var n=o,i=l(e.base.zoomLevel),a=e.base.pan;return{x:1/i*(n.x-a.x),y:1/i*(n.y-a.y)}},d=function(o){e.base=c(o)},y=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},z=function(){var o=jQuery.now();return function(){var n=jQuery.now(),i=(n-o)/1e3;if(o=n,e.dragging)return!0;if(e.zoomAnimation&&(e.zoomAnimation.progress+=i/e.zoomAnimation.duration,e.zoomAnimation.progress>=1&&(e.zoomAnimation.progress=1,r(),e.base.zoomLevel=e.model.zoomLevel,e.base.pan.x=e.model.pan.x,e.base.pan.y=e.model.pan.y,e.zoomAnimation=void 0,e.config.modelChangedCallback(e.model))),e.panVelocity)for(;i>0;){var a=Math.min(.02,i);i-=a,e.base.pan.x+=e.panVelocity.x*a,e.panVelocity.x*=1-e.config.friction*a,e.base.pan.y+=e.panVelocity.y*a,e.panVelocity.y*=1-e.config.friction*a;var t=y(e.panVelocity);if(t<e.config.haltSpeed){e.panVelocity=void 0,e.config.modelChangedCallback(e.model);break}}return r(),!0}};r();var x=new z;jQuery.fx.timer(x),e.onDblClick=function(o){if(e.config.zoomOnDoubleClick){var n={x:o.pageX-a.offset().left,y:o.pageY-a.offset().top};g(n)}};var b,L;e.onMousedown=function(n){e.config.panOnClickDrag&&(L={x:n.pageX,y:n.pageY},b=jQuery.now(),e.dragging=!0,o.on("mousemove",e.onMousemove),o.on("mouseup",e.onMouseup))};var h=function(o){o.x=o.x||0,o.y=o.y||0,e.base.pan.x+=o.x,e.base.pan.y+=o.y,r()};e.model.pan=h,e.onMousemove=function(o){!e.dragging;var n=jQuery.now(),i=(n-b)/1e3;b=n;var a={x:o.pageX-L.x,y:o.pageY-L.y};h(a),e.panVelocity={x:a.x/i,y:a.y/i},L={x:o.pageX,y:o.pageY},o.preventDefault()},e.onMouseup=function(){var n=jQuery.now(),i=(n-b)/1e3;if(e.panVelocity){var a=Math.max(0,Math.pow(i+1,-4)-.2);e.panVelocity.x*=a,e.panVelocity.y*=a}e.dragging=!1,o.off("mousemove",e.onMousemove),o.off("mouseup",e.onMouseup)},e.onMouseleave=function(){e.onMouseup()},e.onMouseWheel=function(o,n,i,t){if(e.config.zoomOnMouseWheel){if(o.preventDefault(),e.zoomAnimation)return;var l=t/Math.abs(t),m={x:o.pageX-a.offset().left,y:o.pageY-a.offset().top};0>l?g(m):u(m)}},n={model:e.model,config:e.config,changeZoomLevel:s,zoomIn:g,zoomOut:u,zoomToFit:d,getViewPosition:p,getModelPosition:v}}],link:function(o,i){var a=i.attr("id");a&&e.registerAPI(a,n)},template:'<div class="pan-zoom-frame" ng-dblclick="onDblClick($event)" ng-mousedown="onMousedown($event)" msd-wheel="onMouseWheel($event, $delta, $deltaX, $deltaY)" style="position:relative;overflow:hidden;cursor:move"><div class="pan-zoom-contents" style="position:absolute;left:0px;top:0px" ng-transclude></div></div>',replace:!0}}]);
angular.module("panzoomwidget",[]).directive("panzoomwidget",["$document",function(o){var e;return{restrict:"E",transclude:!0,controller:["$scope","$element","PanZoomService",function(n,t,i){i.getAPI(e).then(function(e){n.model=e.model,n.config=e.config;var i=t.find(".zoom-slider-widget"),m=!1,u=function(o){return(n.config.zoomLevels-o-1)*n.widgetConfig.zoomLevelHeight},l=function(o){return n.config.zoomLevels-1-o/n.widgetConfig.zoomLevelHeight},g=function(o){var e=o.pageY-t.find(".zoom-slider").offset().top-n.widgetConfig.zoomLevelHeight/2;return l(e)};n.getZoomLevels=function(){for(var o=[],e=n.config.zoomLevels-1;e>=0;e--)o.push(e);return o},n.widgetConfig={zoomLevelHeight:10},n.zoomIn=function(){e.zoomIn()},n.zoomOut=function(){e.zoomOut()},n.onClick=function(o){var n=g(o);e.changeZoomLevel(n)},n.onMousedown=function(){m=!0,o.on("mousemove",n.onMousemove),o.on("mouseup",n.onMouseup)},n.onMousemove=function(o){o.preventDefault();var n=g(o);e.changeZoomLevel(n)},n.onMouseup=function(){m=!1,o.off("mousemove",n.onMousemove),o.off("mouseup",n.onMouseup)},n.onMouseleave=function(){m=!1},setInterval(function(){i.css("top",u(n.model.zoomLevel)+"px")},25)})}],compile:function(o){if(e=o.attr("panzoom-id"),!e)throw"Error in setup. You must define attribute panzoom-id on the <panzoomwidget> element in order to link it to the id of the <panzoom> element. Ref: ";return{pre:function(){},post:function(){}}},template:'<div class="panzoomwidget"><div ng-click="zoomIn()" ng-mouseenter="zoomToLevelIfDragging(config.zoomLevels - 1)" class="zoom-button zoom-button-in">+</div><div class="zoom-slider" ng-mousedown="onMousedown()" ng-click="onClick($event)"><div class="zoom-slider-widget" style="height:{{widgetConfig.zoomLevelHeight - 2}}px"></div><div ng-repeat="zoomLevel in getZoomLevels()" " class="zoom-level zoom-level-{{zoomLevel}}" style="height:{{widgetConfig.zoomLevelHeight}}px"></div></div><div ng-click="zoomOut()" ng-mouseenter="zoomToLevelIfDragging(0)" class="zoom-button zoom-button-out">-</div><div ng-transclude></div></div>',replace:!0}}]);
angular.module("panzoom").factory("PanZoomService",["$q",function(e){var r={},o=function(o,t){r[o]||(r[o]=e.defer());var a=r[o];if(a.hasBeenResolved)throw"Internal error: attempt to register a panzoom API but key was already used. Did you declare two <panzoom> directives with the same id?";a.resolve(t),a.hasBeenResolved=!0},t=function(o){return r[o]||(r[o]=e.defer()),r[o].promise};return{registerAPI:o,getAPI:t}}]);